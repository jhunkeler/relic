# RELIC

## What is RELIC?

RELIC stands for "Release I Control". This software attempts to automatically maintain a git project's version information without the need for hardcoded values in the source code. It is designed primarily for hardcore build maintainers, or for developers with rapid release cycles that cannot be bothered to constantly edit their version information.

## License

BSD 3-Clause

## Installing RELIC

### From PyPi with pip (release)

```bash
pip install relic
```

### From GitHub with pip (devel)

```bash
pip install git+https://github.com/spacetelescope/relic.git
```

### From Github with git (devel)

```bash
git clone https://github.com/spacetelescope/relic.git
cd relic
python setup.py install
```

## Incorporating RELIC into your project


**Configure `setup.py`**

This configuration block handles how RELIC will be obtained. Refrain from making changes to this code unless you know what you are doing.

```python
import os
import pkgutil
import sys
from setuptools import setup
from subprocess import check_call, CalledProcessError


if not pkgutil.find_loader('relic'):
    relic_local = os.path.exists('relic')
    relic_submodule = (relic_local and
                       os.path.exists('.gitmodules') and
                       not os.listdir('relic'))
    try:
        if relic_submodule:
            check_call(['git', 'submodule', 'update', '--init', '--recursive'])
        elif not relic_local:
            check_call(['git', 'clone', 'https://github.com/spacetelescope/relic.git'])

        sys.path.insert(1, 'relic')
    except CalledProcessError as e:
        print(e)
        exit(1)

import relic.release

version = relic.release.get_info()
relic.release.write_template(version, 'sample/')

setup(
    name='sample',
    version=version.pep386,
    #...
)
```

### As a Git Submodule

**Add the RELIC submodule to your project:**

```bash
git submodule add https://github.com/spacetelescope/relic.git
```

RELIC's standard `setup.py` configuration handles the git submodule approach without any user-made changes.

## Additional Requirements

**Configure MANIFEST.in:**

In order to build using a tarball generated with `python setup.py sdist`, you will need to create a `MANIFEST.in` file to retain the `RELIC-INFO` cache created at build-time. `RELIC-INFO` contains your project's version information in an easy-to-parse JSON array. It is also in your best interest to prevent distributing `[package_path]/version.py`, because it is regenerated using data from `RELIC-INFO`.

```
include RELIC-INFO
prune sample/version.py

# Not recommended: Uncomment below to bundle RELIC during `sdist`
#
#recursive-include relic *
#prune relic/.git
#prune relic/tests
```

**Configure .gitignore:**

`RELIC-INFO` and `[package_path]/version.py` are generated automatically, so they should **never** be committed to your repository. To prevent this from happening, append these paths to `.gitignore` (replacing `sample/` with your package directory).

```
RELIC-INFO
sample/version.py
```

## Retreiving Information

A simple example using version.py:

```python
>>> from .version import *
>>> print('Sample {0} (Date: {1}) [{2}]'.format(
    __version__,
    __version_date__, 
    __build_status__))
Sample 0.0.6 (Date: 2016-03-25 17:34:17 -0400) [release]
>>>
```

## Version module

Here are a few examples of what `version.py` might look like during different stages of development.

### Standard release tag

```python
# AUTOMATICALLY GENERATED BY 'RELIC':
# * DO NOT EDIT THIS MODULE MANUALLY.
# * DO NOT COMMIT THIS MODULE TO YOUR GIT REPOSITORY

__all__ = [
    '__version__',
    '__version_short__',
    '__version_long__',
    '__version_post__',
    '__version_commit__',
    '__version_date__',
    '__version_dirty__',
    '__build_date__',
    '__build_status__'
]

__version__ = '0.0.6'
__version_short__ = '0.0.6'
__version_long__ = '0.0.6-0-feaf392a
__version_post__ = '0'
__version_commit__ = 'feaf392a'
__version_date__ = '2016-03-25 17:34:17 -0400'
__version_dirty__ = False
__build_date__ = '2016-03-26'
__build_time__ = '17:13:50.997002'
__build_status__ = 'release' if not int(__version_post__) > 0 \
    and not __version_dirty__ \
    else 'development'
```

### Post-commit on tag

```python
# AUTOMATICALLY GENERATED BY 'RELIC':
# * DO NOT EDIT THIS MODULE MANUALLY.
# * DO NOT COMMIT THIS MODULE TO YOUR GIT REPOSITORY

__all__ = [
    '__version__',
    '__version_short__',
    '__version_long__',
    '__version_post__',
    '__version_commit__',
    '__version_date__',
    '__version_dirty__',
    '__build_date__',
    '__build_status__'
]

__version__ = '0.0.6.dev1+gadef541a'
__version_short__ = '0.0.6'
__version_long__ = '0.0.6-1-adef541a'
__version_post__ = '1'
__version_commit__ = 'adef541a'
__version_date__ = '2016-03-26 00:55:27 -0400'
__version_dirty__ = False
__build_date__ = '2016-03-26'
__build_time__ = '17:19:29.884038'
__build_status__ = 'release' if not int(__version_post__) > 0 \
    and not __version_dirty__ \
    else 'development'
```

### Dirty post-commit on tag

```python
# AUTOMATICALLY GENERATED BY 'RELIC':
# * DO NOT EDIT THIS MODULE MANUALLY.
# * DO NOT COMMIT THIS MODULE TO YOUR GIT REPOSITORY

__all__ = [
    '__version__',
    '__version_short__',
    '__version_long__',
    '__version_post__',
    '__version_commit__',
    '__version_date__',
    '__version_dirty__',
    '__build_date__',
    '__build_status__'
]

__version__ = '0.0.6.dev1+gadef541a'
__version_short__ = '0.0.6'
__version_long__ = '0.0.6-1-adef541a-dirty'
__version_post__ = '1'
__version_commit__ = 'adef541a'
__version_date__ = '2016-03-26 00:55:27 -0400'
__version_dirty__ = True
__build_date__ = '2016-03-26'
__build_time__ = '17:20:54.291836'
__build_status__ = 'release' if not int(__version_post__) > 0 \
    and not __version_dirty__ \
    else 'development'
```

